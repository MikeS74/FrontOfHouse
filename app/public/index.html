<!DOCTYPE html>
<html>

<head>
    <title>Front of House</title>
    <link rel="stylesheet" href="static/assets/css/minimal-form.css" />
    <link rel="stylesheet" href="static/assets/css/list-results.css" />
</head>

<body>
    <!-- Upper left Bar of links (Write a review, Company) -->

    <!-- Upper right Login link -->

    <!-- Recent Reviews -->

    <!-- Top Places (on the left) Worst Places (on the right) -->

    <!-- User input field -->
    <div id="search-bar-div" class="form-group">
        <form id="form" class="topBefore">
            <header>SEARCH BUSINESS:</header>
            <input class="input-bar typeahead" id="user-input" type="text" placeholder="NAME">

            <!-- Search button -->
            <input class="input-search" id="run-search" type="submit" value="SEARCH">
        </form>
    </div>
    
    <div id="list-view">
    
    
    </div>
    
    <script src="https://code.jquery.com/jquery.js"></script>
    
    <script type="text/javascript">

var globalRestID = "";
var globalRestName = "";
var globalRestLoc = "";
        

//$(document).ready(function () {

    // Event listener for search button
    $("#run-search").on("click", function (event) {

        event.preventDefault();

        // Create a variable for the user input
        var search = $("#user-input").val().trim();

        $("#search-bar-div").hide();

        // Construct a URL to search user input in API
        var queryURL = "https://developers.zomato.com/api/v2.1/search?q=" +
            search + "&lat=34.0353061&lon=-118.3794192&radius=13%2C000" + "&apikey=abf456dfeacd356e5b295aa8cb32a4a6";

        // AJAX Request
        $.ajax({
                url: queryURL,
                method: "GET"
            })
            // Store the search results in a variable
            .done(function (response) {

                // Storing an array of results in the results variable
                var results = response.restaurants;

                console.log(results);

                for (var i = 0; i < results.length; i++) {

                    var listDiv = $("<div class='list-gen'>");
                    var restResults = response.restaurants[i];
                    var restName = restResults.restaurant.name;
                    var restLoc = restResults.restaurant.location.address;
                    var restRating = restResults.restaurant.user_rating.aggregate_rating;
                    var restID = restResults.restaurant.id;
                    var dispAll = $("<p class='rest-list-item'>").html(restName + "<br>" + restLoc + "<br>" + "Customer Rating: " + restRating + "<br>").attr({
                        "data-zomato-id": restID,
                        "data-zomato-name": restName,
                        "data-zomato-loc": restLoc
                    });
                    listDiv.append(dispAll);
//                    console.log(restLoc + " " + restID);

                    $("#list-view").append(listDiv);
                };
                $(".rest-list-item").on("click", function (event) {
                    var uniqueRestID = $(this).attr("data-zomato-id");
                    var uniqueRestName = $(this).attr("data-zomato-name");
                    var uniqueRestLoc = $(this).attr("data-zomato-loc");
                    globalRestID = uniqueRestID;
                    globalRestName = uniqueRestName;
                    globalRestLoc = uniqueRestLoc;
                    
                    console.log("Grab Zomato ID On Click Test " + globalRestID);
                    
                    var currentURL = window.location.origin;
                    $.post(currentURL + "/api/friends", {rest_id: globalRestID, business_name: globalRestName, business_loc: globalRestLoc}, function(data) {
                    console.log(data);
                        
                });
            });
    });
});

</script>

    <!-- Links and credit -->

    <!-- jQuery JS -->
   
    <!-- jqeury link -->
    <script src ="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js"></script>
    
    <!--typehead link -->
    <script src ="https://cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.11.1/typeahead.jquery.js"></script>
    
    <!-- bloodhound link -->
    <script src ="https://cdnjs.cloudflare.com/ajax/libs/corejs-typeahead/1.2.1/bloodhound.js"></script>

    <!-- Code to the JavaScript File -->
    <script src="static/assets/js/autocomplete.js"></script>
    
</body>

</html>